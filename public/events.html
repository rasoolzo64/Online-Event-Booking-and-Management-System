<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>All Events - EventHub</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="/js/auth.js"></script>
</head>

<body>
    <header>
        <div class="container header-content">
            <div class="logo">EventHub</div>
            <ul class="nav-menu">
                <li><a href="/">Home</a></li>
                <li><a href="/events.html" class="active">Events</a></li>
                <li><a href="/my-bookings.html" id="navThirdLink">My Bookings</a></li>
            </ul>
            <div class="auth-buttons" id="authButtons">
                <!-- This will be populated by auth.js -->
            </div>
        </div>
    </header>

    <section class="container">
        <h2 class="section-title">All Upcoming Events</h2>

        <div id="loadingMessage" class="alert alert-info" style="text-align: center;">
            <p>Loading events...</p>
        </div>

        <div id="eventsContainer" class="events-grid" style="display: none;">
            <!-- Events will be loaded by JavaScript -->
        </div>

        <div id="errorMessage" class="alert alert-danger" style="display: none; text-align: center;">
            <!-- Error messages will be shown here -->
        </div>
    </section>

    <div class="simple-footer">
        <p>&copy; 2025 EventHub. All rights reserved.</p>
    </div>

    <script>
        // Load all events 
        async function loadEvents() {
            try {
                console.log('Loading events from API...');

                const response = await fetch('/api/events');

                if (!response.ok) {
                    throw new Error(`Server returned ${response.status}: ${response.statusText}`);
                }

                const events = await response.json();
                console.log('Events loaded:', events);

                // Hide loading message
                document.getElementById('loadingMessage').style.display = 'none';

                const eventsContainer = document.getElementById('eventsContainer');

                if (events.length === 0) {
                    eventsContainer.innerHTML = `
                <div style="text-align: center; padding: 40px; grid-column: 1 / -1;">
                    <h3>No Events Available</h3>
                    <p>There are no events available at the moment.</p>
                    <p>Please check back later or contact organizers.</p>
                </div>
            `;
                } else {
                    eventsContainer.innerHTML = '';

                    // Only show approved events
                    const approvedEvents = events.filter(event => event.status === 'approved');
                    
                    if (approvedEvents.length === 0) {
                        eventsContainer.innerHTML = `
                    <div style="text-align: center; padding: 40px; grid-column: 1 / -1;">
                        <h3>No Approved Events Available</h3>
                        <p>All events are currently pending approval.</p>
                        <p>Please check back later.</p>
                    </div>
                `;
                    } else {
                        approvedEvents.forEach(event => {
                            const eventDate = new Date(event.date).toLocaleDateString();
                            const eventTime = new Date(event.date).toLocaleTimeString();

                            const eventCard = `
                        <div class="event-card">
                            <div class="event-image" style="background-image: url('${event.image_url || 'https://images.unsplash.com/photo-1501281668745-f7f57925c3b4?w=500&h=300&fit=crop'}');"></div>
                            <div class="event-content">
                                <h3 class="event-title">${event.title}</h3>
                                <div class="event-meta">
                                    <span>${eventDate}</span>
                                    <span>${eventTime}</span>
                                </div>
                                <div class="event-meta">
                                    <span>${event.location}</span>
                                    <span>Organized by: ${event.organizer_name || 'EventHub'}</span>
                                </div>
                                <p class="event-description">${event.description}</p>
                                <div class="event-meta">
                                    <span>Seats: ${event.available_seats}/${event.total_seats}</span>
                                    <span>₹${event.price} per ticket</span>
                                </div>
                                <div class="event-actions">
                                    <span class="event-price">Total: ₹${event.price}</span>
                                    <a href="/booking.html?eventId=${event.id}" class="btn btn-primary">Book Now</a>
                                </div>
                            </div>
                        </div>
                    `;

                            eventsContainer.innerHTML += eventCard;
                        });
                    }
                }

                // Show events container
                eventsContainer.style.display = 'grid';
                console.log('Events displayed on page');

            } catch (error) {
                console.error('Error loading events:', error);

                // Hide loading message
                document.getElementById('loadingMessage').style.display = 'none';

                // Show error message
                const errorMessage = document.getElementById('errorMessage');
                errorMessage.innerHTML = `
            <h3>Error Loading Events</h3>
            <p>${error.message}</p>
            <p>Please check if the server is running and try again.</p>
            <button onclick="loadEvents()" class="btn btn-primary">Retry</button>
        `;
                errorMessage.style.display = 'block';
            }
        }

        // Load events when page loads
        document.addEventListener('DOMContentLoaded', loadEvents);
    </script>
</body>

</html>
